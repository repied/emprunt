<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Emprunt — Mortgage Simulator</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js" charset="utf-8"></script>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
</head>

<body>
    <header>
        <h1>Emprunt</h1>
        <p>Advanced Mortgage Simulation & Interest Analysis</p>
    </header>

    <main>
        <section class="form">
            <form method="post" action="/simulate">
                <div class="form-grid">
                    <label>
                        Home Cost (€)
                        <input name="home_cost" type="number" step="10000"
                            value="{{ result.home_cost if result else 300000 }}" required>
                    </label>
                    <label>
                        Down Payment (€)
                        <input name="down_payment" type="number" step="1000"
                            value="{{ result.down_payment if result else 60000 }}" required>
                    </label>
                    <label>
                        Annual Rate (%)
                        <input name="annual_rate" type="number" step="0.01"
                            value="{{ result.annual_rate if result else 3.5 }}" required>
                    </label>
                    <label>
                        Years
                        <input name="years" type="number" value="{{ result.years if result else 25 }}" required>
                    </label>
                    <label>
                        Initial Savings (€)
                        <input name="savings" type="number" step="1000"
                            value="{{ result.savings if result else 100000 }}" required>
                    </label>
                    <label>
                        Investment Rate (%)
                        <input name="investment_rate" type="number" step="0.1"
                            value="{{ result.investment_rate if result else 7 }}" required>
                    </label>
                    <label>
                        Monthly Cash flow (€)
                        <input name="monthly_cash" type="number" step="100"
                            value="{{ result.monthly_cash if result else 2500 }}" required>
                    </label>
                </div>
                <button type="submit">Simulate Wealth</button>
            </form>
        </section>

        {% if result %}
        <section class="result">
            <h2>Simulation Results</h2>

            <div class="summary-cards">
                <div class="card">
                    <span class="label">Monthly Payment</span>
                    <span class="value">€{{ "{:,.0f}".format(result.payment) }}</span>
                </div>
                <div class="card">
                    <span class="label">Loan Amount</span>
                    <span class="value">€{{ "{:,.0f}".format(result.principal) }}</span>
                </div>
                <div class="card">
                    <span class="label">Final Wealth</span>
                    <span class="value">€{{ "{:,.0f}".format(result.schedule[-1].combined_wealth) }}</span>
                </div>
            </div>

            <div id="plot-container">
                <div id="wealth-plot" style="width:100%;height:500px;"></div>
            </div>

            <h3>Amortization & Growth</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Payment</th>
                            <th>Balance</th>
                            <th>Home Equity</th>
                            <th>Investments</th>
                            <th>Combined Wealth</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in result.schedule %}
                        {% if loop.index % 12 == 1 or loop.last %}
                        <tr>
                            <td>{{ row.period }}</td>
                            <td>€{{ "{:,.0f}".format(row.payment) }}</td>
                            <td>€{{ "{:,.0f}".format(row.balance) }}</td>
                            <td>€{{ "{:,.0f}".format(row.home_equity) }}</td>
                            <td>€{{ "{:,.0f}".format(row.investment_portfolio) }}</td>
                            <td>€{{ "{:,.0f}".format(row.combined_wealth) }}</td>
                        </tr>
                        {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
                <p class="table-note">* Showing yearly snapshots for brevity.</p>
            </div>
        </section>

        <script>
            (function () {
                const schedule = {{ result.schedule | tojson | safe
            }};
            if (!schedule || schedule.length === 0) return;

            const periods = schedule.map(row => row.period);
            const equities = schedule.map(row => row.home_equity);
            const investments = schedule.map(row => row.investment_portfolio);
            const combined = schedule.map(row => row.combined_wealth);

            const traceEquity = {
                x: periods,
                y: equities,
                name: 'Home Equity',
                type: 'scatter',
                mode: 'lines',
                stackgroup: 'one',
                line: { color: '#4f46e5', width: 2 },
                fillcolor: 'rgba(79, 70, 229, 0.4)'
            };

            const traceInvestments = {
                x: periods,
                y: investments,
                name: 'Investments',
                type: 'scatter',
                mode: 'lines',
                stackgroup: 'one',
                line: { color: '#10b981', width: 2 },
                fillcolor: 'rgba(16, 185, 129, 0.4)'
            };

            const traceCombined = {
                x: periods,
                y: combined,
                name: 'Combined Wealth',
                type: 'scatter',
                mode: 'lines',
                line: { color: '#000', width: 2, dash: 'dot' }
            };

            const layout = {
                title: {
                    text: 'Combined Wealth Projection',
                    font: { family: 'Inter', size: 24, weight: 700 }
                },
                xaxis: {
                    title: 'Months',
                    gridcolor: '#f0f0f0'
                },
                yaxis: {
                    title: 'Wealth (€)',
                    gridcolor: '#f0f0f0',
                    tickformat: '€,.0f'
                },
                margin: { t: 80, b: 60, l: 80, r: 40 },
                hovermode: 'x unified',
                legend: { orientation: 'h', y: -0.2 },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };

            const config = { responsive: true, displayModeBar: false };
            Plotly.newPlot('wealth-plot', [traceEquity, traceInvestments, traceCombined], layout, config);
            }) ();
        </script>
        {% endif %}
    </main>

    <footer>
        <p>&copy; 2023 Emprunt. Built with Precision & Style.</p>
    </footer>
</body>

</html>
