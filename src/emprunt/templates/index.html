<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Emprunt â€” Mortgage Simulator</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js" charset="utf-8"></script>
</head>

<body>
    <header>
        <h1>Emprunt</h1>
        <p>Advanced Mortgage Simulation & Interest Analysis</p>
    </header>

    <main>
        <section class="form">
            <form method="post" action="/simulate">
                <label>
                    Principal ($)
                    <input name="principal" type="number" step="0.01"
                        value="{{ result.principal if result else 100000 }}" required>
                </label>
                <label>
                    Annual Rate (%)
                    <input name="annual_rate" type="number" step="0.01"
                        value="{{ result.annual_rate if result else 3.5 }}" required>
                </label>
                <label>
                    Years
                    <input name="years" type="number" value="{{ result.years if result else 20 }}" required>
                </label>
                <button type="submit">Simulate Mortgage</button>
            </form>
        </section>

        {% if result %}
        <section class="result">
            <h2>Simulation Results</h2>

            <div class="summary-cards">
                <div class="card">
                    <span class="label">Monthly Payment</span>
                    <span class="value">${{ "{:,.2f}".format(result.payment) }}</span>
                </div>
                <div class="card">
                    <span class="label">Total Principal</span>
                    <span class="value">${{ "{:,.2f}".format(result.principal) }}</span>
                </div>
                <div class="card">
                    <span class="label">Loan Duration</span>
                    <span class="value">{{ result.years }} Years</span>
                </div>
            </div>

            <div id="plot-container">
                <div id="balance-plot" style="width:100%;height:450px;"></div>
            </div>

            <h3>Amortization Schedule</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Period (Month)</th>
                            <th>Payment</th>
                            <th>Principal Paid</th>
                            <th>Interest Paid</th>
                            <th>Remaining Balance</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in result.schedule %}
                        <tr>
                            <td>{{ row.period }}</td>
                            <td>${{ "{:,.2f}".format(row.payment) }}</td>
                            <td>${{ "{:,.2f}".format(row.principal_paid) }}</td>
                            <td>${{ "{:,.2f}".format(row.interest_paid) }}</td>
                            <td>${{ "{:,.2f}".format(row.balance) }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

        <script>
            (function () {
                const schedule = {{ result.schedule | tojson | safe
            }};
            if (!schedule || schedule.length === 0) return;

            const periods = schedule.map(row => row.period);
            const balances = schedule.map(row => row.balance);

            const trace = {
                x: periods,
                y: balances,
                type: 'scatter',
                mode: 'lines',
                name: 'Remaining Balance',
                line: {
                    color: '#4f46e5',
                    width: 3,
                    shape: 'spline'
                },
                fill: 'tozeroy',
                fillcolor: 'rgba(79, 70, 229, 0.1)'
            };

            const layout = {
                title: {
                    text: 'Remaining Balance Over Time',
                    font: { family: 'Inter', size: 20, weight: 700 }
                },
                xaxis: {
                    title: 'Payment Period (Months)',
                    gridcolor: '#f0f0f0'
                },
                yaxis: {
                    title: 'Balance ($)',
                    gridcolor: '#f0f0f0',
                    tickformat: '$,.0f'
                },
                margin: { t: 60, b: 60, l: 80, r: 40 },
                hovermode: 'x unified',
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };

            const config = { responsive: true, displayModeBar: false };

            Plotly.newPlot('balance-plot', [trace], layout, config);
            }) ();
        </script>
        {% endif %}
    </main>

    <footer>
        <p>&copy; 2023 Emprunt. Built with Precision & Style.</p>
    </footer>
</body>

</html>
